cmake_minimum_required(VERSION 3.11)
project(pntr_app_web
    DESCRIPTION "Web host for pntr_app games"
    HOMEPAGE_URL "https://github.com/konsumer/pntr_app_web"
    VERSION 0.0.1
    LANGUAGES C
)

if (NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE "Release")
endif()


add_definitions(-DPNTR_ENABLE_VARGS)

set(CMAKE_EXE_LINKER_FLAGS "-s ASSERTIONS -s ASYNCIFY -s USE_GLFW=3  -O2 -s WASM=1 -s INVOKE_RUN=0 -sEXPORTED_FUNCTIONS=_user_set_size,_malloc,_free,_main,_pntr_new_image,_pntr_gen_image_color,_pntr_image_copy,_pntr_image_from_image,_pntr_image_subimage,_pntr_unload_image,_pntr_clear_background,_pntr_draw_point,_pntr_draw_point_vec,_pntr_draw_points,_pntr_draw_line,_pntr_draw_line_vec,_pntr_draw_line_vertical,_pntr_draw_line_horizontal,_pntr_draw_rectangle,_pntr_draw_rectangle_rec,_pntr_draw_rectangle_fill,_pntr_draw_rectangle_fill_rec,_pntr_draw_rectangle_gradient,_pntr_draw_rectangle_gradient_rec,_pntr_draw_triangle,_pntr_draw_triangle_vec,_pntr_draw_triangle_fill,_pntr_draw_triangle_fill_vec,_pntr_draw_ellipse,_pntr_draw_ellipse_fill,_pntr_draw_circle,_pntr_draw_circle_fill,_pntr_draw_polygon,_pntr_draw_polygon_fill,_pntr_draw_polyline,_pntr_draw_arc,_pntr_draw_arc_fill,_pntr_draw_rectangle_rounded,_pntr_draw_rectangle_rounded_fill,_pntr_draw_image,_pntr_draw_image_rec,_pntr_draw_image_tint,_pntr_draw_image_tint_rec,_pntr_draw_image_rotated,_pntr_draw_image_rotated_rec,_pntr_draw_image_flipped,_pntr_draw_image_flipped_rec,_pntr_draw_image_scaled,_pntr_draw_image_scaled_rec,_pntr_draw_text,_pntr_draw_text_wrapped,_pntr_draw_text_ex,_pntr_new_color,_pntr_get_color,_pntr_color_get_r,_pntr_color_get_g,_pntr_color_get_b,_pntr_color_get_a,_pntr_color_set_r,_pntr_color_set_g,_pntr_color_set_b,_pntr_color_set_a,_pntr_image_get_color,_pntr_save_file,_pntr_image_to_pixelformat,_pntr_save_image,_pntr_save_image_to_memory,_pntr_get_pixel_data_size,_pntr_load_image,_pntr_load_image_from_memory,_pntr_image_from_pixelformat,_pntr_set_error,_pntr_get_error,_pntr_get_error_code,_pntr_image_resize,_pntr_image_scale,_pntr_image_color_replace,_pntr_color_tint,_pntr_image_color_tint,_pntr_color_fade,_pntr_image_color_fade,_pntr_color_brightness,_pntr_get_pixel_color,_pntr_set_pixel_color,_pntr_load_font_default,_pntr_unload_font,_pntr_font_copy,_pntr_font_scale,_pntr_load_font_bmf,_pntr_load_font_bmf_from_image,_pntr_load_font_bmf_from_memory,_pntr_measure_text,_pntr_measure_text_ex,_pntr_gen_image_text,_pntr_load_font_tty,_pntr_load_font_tty_from_memory,_pntr_load_font_tty_from_image,_pntr_load_file,_pntr_unload_file,_pntr_load_file_text,_pntr_unload_file_text,_pntr_load_font_ttf,_pntr_load_font_ttf_from_memory,_pntr_color_invert,_pntr_image_color_invert,_pntr_color_alpha_blend,_pntr_image_alpha_border,_pntr_image_crop,_pntr_image_alpha_crop,_pntr_image_color_brightness,_pntr_image_flip,_pntr_color_contrast,_pntr_image_color_contrast,_pntr_image_alpha_mask,_pntr_image_resize_canvas,_pntr_image_rotate,_pntr_gen_image_gradient,_pntr_color_bilinear_interpolate,_pntr_load_memory,_pntr_unload_memory,_pntr_memory_copy,_pntr_get_file_image_type,_pntr_put_horizontal_line_unsafe,_pntr_draw_point_unsafe,_pntr_load_sound,_pntr_load_sound_from_memory,_pntr_unload_sound,_pntr_play_sound,_pntr_stop_sound,_pntr_app_get_file_sound_type,_pntr_app_userdata,_pntr_app_set_userdata,_pntr_app_width,_pntr_app_height,_pntr_app_delta_time,_pntr_app_random,_pntr_app_random_seed,_pntr_app_log,_pntr_app_key_pressed,_pntr_app_key_down,_pntr_app_key_released,_pntr_app_key_up,_pntr_app_gamepad_button_pressed,_pntr_app_gamepad_button_down,_pntr_app_gamepad_button_released,_pntr_app_gamepad_button_up,_pntr_app_mouse_x,_pntr_app_mouse_y,_pntr_app_mouse_delta_x,_pntr_app_mouse_delta_y,_pntr_app_mouse_button_pressed,_pntr_app_mouse_button_down,_pntr_app_mouse_button_released,_pntr_app_mouse_button_up,_pntr_app_set_title,_pntr_app_title,_pntr_app_set_size,_pntr_app_set_icon,_pntr_app_load_arg_file,_pntr_app_log_ex -sEXPORTED_RUNTIME_METHODS=callMain,ccall,UTF8ToString,stringToUTF8,lengthBytesUTF8")

list(APPEND CMAKE_MODULE_PATH "${PROJECT_SOURCE_DIR}/.cmake")

find_package(pntr REQUIRED)
find_package(pntr_app REQUIRED)

add_executable(${PROJECT_NAME} src/main.c)
target_compile_definitions(${PROJECT_NAME} PUBLIC PNTR_APP_WEB)
target_link_libraries(${PROJECT_NAME} PUBLIC pntr pntr_app)
set_target_properties(${PROJECT_NAME} PROPERTIES SUFFIX ".mjs")
set_property(TARGET ${PROJECT_NAME} PROPERTY C_STANDARD 99)

set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS}")
